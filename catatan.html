<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Penyimpan Teks - Catatan Pribadi</title>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Catatan Saya">
    <meta name="description" content="Aplikasi catatan pribadi yang berfungsi offline">
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,ewogICJuYW1lIjogIkNhdGF0YW4gU2F5YSIsCiAgInNob3J0X25hbWUiOiAiQ2F0YXRhbiIsCiAgImRlc2NyaXB0aW9uIjogIkFwbGlrYXNpIGNhdGF0YW4gcHJpYmFkaSB5YW5nIGJlcmZ1bmdzaSBvZmZsaW5lIiwKICAic3RhcnRfdXJsIjogIi8iLAogICJkaXNwbGF5IjogInN0YW5kYWxvbmUiLAogICJiYWNrZ3JvdW5kX2NvbG9yIjogIiNmOWZhZmIiLAogInRoZW1lX2NvbG9yIjogIiMyNTYzZWIiLAogICJvcmllbnRhdGlvbiI6ICJwb3J0cmFpdC1wcmltYXJ5IiwKICAiaWNvbnMiOiBbCiAgICB7CiAgICAgICJzcmMiOiAiZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNITTZMeTlsZUdGdGNHeGxMbU52YlM5MmFXUmxieTVzYjJOaGJHeDVjM1J2YldWeVgybGtJam9pUTFWVFZFOU5SVkpmTVRJek5EVTJJaXdpYVhOemRXVmtYMlJoZEdVaU9pSXlNREkwTFRFd0xURXdWREV3T2pBd09qQXdXaUlzSW1WNGNHbHllVjlrWVhSbElqb2lNakF5TlMweE1DMHhNRlF4TURvd01Eb3dNRm9pTENKd2NtOWtkV04wSWpvaWRIbHJMVzl3WlhKaGRHOXlJaXdpYldGamFHbHVaVjltYVc1blpYSndjbWx1ZENJNklqRXlNelExTmpjNE9UQXhNak0wSW4wPQ==IiwKICAgICAgInNpemVzIjogIjE5MngxOTIiLAogICAgICAidHlwZSI6ICJpbWFnZS9zdmcreG1sIiwKICAgICAgInB1cnBvc2UiOiAiYW55IG1hc2thYmxlIgogICAgfQogIF0KfQ==">
    
    <!-- Apple Touch Icon -->
    <link rel="apple-touch-icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiBmaWxsPSIjMjU2M2ViIi8+CjxwYXRoIGQ9Ik00OCA0OEgxNjBWMTYwSDQ4VjQ4WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTgwIDQ4SDExMlYxNjBIODBWNDhaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K">
    
    <style>
        /* Tailwind CSS Classes - Inline Version */
        *, ::before, ::after {
            box-sizing: border-box;
            border-width: 0;
            border-style: solid;
            border-color: #e5e7eb;
        }
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            line-height: 1.5;
            color: #1f2937;
            background-color: #f9fafb;
        }
        .bg-gray-50 { background-color: #f9fafb; }
        .bg-white { background-color: #ffffff; }
        .bg-blue-600 { background-color: #2563eb; }
        .bg-blue-100 { background-color: #dbeafe; }
        .bg-green-100 { background-color: #d1fae5; }
        .bg-green-600 { background-color: #16a34a; }
        .bg-purple-100 { background-color: #e9d5ff; }
        .bg-purple-600 { background-color: #9333ea; }
        .bg-red-500 { background-color: #ef4444; }
        .bg-red-600 { background-color: #dc2626; }
        .bg-orange-600 { background-color: #ea580c; }
        .bg-gray-100 { background-color: #f3f4f6; }
        .bg-gray-200 { background-color: #e5e7eb; }
        .bg-gray-300 { background-color: #d1d5db; }
        .bg-gray-400 { background-color: #9ca3af; }
        .bg-gray-500 { background-color: #6b7280; }
        .bg-gray-600 { background-color: #4b5563; }
        .bg-gray-800 { background-color: #1f2937; }
        .text-white { color: #ffffff; }
        .text-blue-600 { color: #2563eb; }
        .text-green-600 { color: #16a34a; }
        .text-purple-600 { color: #9333ea; }
        .text-red-500 { color: #ef4444; }
        .text-red-600 { color: #dc2626; }
        .text-orange-600 { color: #ea580c; }
        .text-orange-700 { color: #c2410c; }
        .text-gray-300 { color: #d1d5db; }
        .text-gray-400 { color: #9ca3af; }
        .text-gray-500 { color: #6b7280; }
        .text-gray-600 { color: #4b5563; }
        .text-gray-700 { color: #374151; }
        .text-gray-800 { color: #1f2937; }
        .text-gray-900 { color: #111827; }
        .text-sm { font-size: 0.875rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .text-6xl { font-size: 3.75rem; }
        .font-medium { font-weight: 500; }
        .font-semibold { font-weight: 600; }
        .font-bold { font-weight: 700; }
        .p-4 { padding: 1rem; }
        .p-6 { padding: 1.5rem; }
        .p-8 { padding: 2rem; }
        .px-4 { padding-left: 1rem; padding-right: 1rem; }
        .px-6 { padding-left: 1.5rem; padding-right: 1.5rem; }
        .px-8 { padding-left: 2rem; padding-right: 2rem; }
        .py-2 { padding-top: 0.5rem; padding-bottom: 0.5rem; }
        .py-3 { padding-top: 0.75rem; padding-bottom: 0.75rem; }
        .py-4 { padding-top: 1rem; padding-bottom: 1rem; }
        .py-8 { padding-top: 2rem; padding-bottom: 2rem; }
        .py-16 { padding-top: 4rem; padding-bottom: 4rem; }
        .m-1 { margin: 0.25rem; }
        .m-2 { margin: 0.5rem; }
        .m-4 { margin: 1rem; }
        .mx-1 { margin-left: 0.25rem; margin-right: 0.25rem; }
        .mx-2 { margin-left: 0.5rem; margin-right: 0.5rem; }
        .mx-4 { margin-left: 1rem; margin-right: 1rem; }
        .mx-auto { margin-left: auto; margin-right: auto; }
        .my-2 { margin-top: 0.5rem; margin-bottom: 0.5rem; }
        .my-4 { margin-top: 1rem; margin-bottom: 1rem; }
        .my-6 { margin-top: 1.5rem; margin-bottom: 1.5rem; }
        .my-8 { margin-top: 2rem; margin-bottom: 2rem; }
        .mt-1 { margin-top: 0.25rem; }
        .mt-2 { margin-top: 0.5rem; }
        .mt-4 { margin-top: 1rem; }
        .mt-6 { margin-top: 1.5rem; }
        .mt-8 { margin-top: 2rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-3 { margin-bottom: 0.75rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mb-6 { margin-bottom: 1.5rem; }
        .mb-8 { margin-bottom: 2rem; }
        .ml-2 { margin-left: 0.5rem; }
        .mr-1 { margin-right: 0.25rem; }
        .mr-2 { margin-right: 0.5rem; }
        .mr-4 { margin-right: 1rem; }
        .rounded { border-radius: 0.25rem; }
        .rounded-lg { border-radius: 0.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .rounded-2xl { border-radius: 1rem; }
        .rounded-full { border-radius: 9999px; }
        .border { border-width: 1px; }
        .border-2 { border-width: 2px; }
        .border-gray-200 { border-color: #e5e7eb; }
        .border-gray-300 { border-color: #d1d5db; }
        .border-blue-500 { border-color: #3b82f6; }
        .border-transparent { border-color: transparent; }
        .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
        .shadow-md { box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .shadow-lg { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .shadow-xl { box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        .outline-none { outline: 2px solid transparent; outline-offset: 2px; }
        .overflow-hidden { overflow: hidden; }
        .overflow-y-auto { overflow-y: auto; }
        .relative { position: relative; }
        .absolute { position: absolute; }
        .fixed { position: fixed; }
        .inset-0 { top: 0; right: 0; bottom: 0; left: 0; }
        .top-0 { top: 0; }
        .right-0 { right: 0; }
        .bottom-0 { bottom: 0; }
        .left-0 { left: 0; }
        .z-10 { z-index: 10; }
        .z-20 { z-index: 20; }
        .z-30 { z-index: 30; }
        .z-40 { z-index: 40; }
        .z-50 { z-index: 50; }
        .flex { display: flex; }
        .inline-flex { display: inline-flex; }
        .grid { display: grid; }
        .hidden { display: none; }
        .flex-col { flex-direction: column; }
        .flex-row { flex-direction: row; }
        .items-center { align-items: center; }
        .items-start { align-items: flex-start; }
        .justify-center { justify-content: center; }
        .justify-between { justify-content: space-between; }
        .justify-start { justify-content: flex-start; }
        .flex-1 { flex: 1 1 0%; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .gap-6 { gap: 1.5rem; }
        .space-x-2 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(0.5rem * var(--tw-space-x-reverse)); margin-left: calc(0.5rem * calc(1 - var(--tw-space-x-reverse))); }
        .space-x-3 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(0.75rem * var(--tw-space-x-reverse)); margin-left: calc(0.75rem * calc(1 - var(--tw-space-x-reverse))); }
        .space-x-4 > :not([hidden]) ~ :not([hidden]) { --tw-space-x-reverse: 0; margin-right: calc(1rem * var(--tw-space-x-reverse)); margin-left: calc(1rem * calc(1 - var(--tw-space-x-reverse))); }
        .space-y-4 > :not([hidden]) ~ :not([hidden]) { --tw-space-y-reverse: 0; margin-top: calc(1rem * calc(1 - var(--tw-space-y-reverse))); margin-bottom: calc(1rem * var(--tw-space-y-reverse)); }
        .cursor-pointer { cursor: pointer; }
        .select-none { user-select: none; }
        .resize-none { resize: none; }
        .w-full { width: 100%; }
        .max-w-6xl { max-width: 72rem; }
        .max-w-4xl { max-width: 56rem; }
        .max-w-2xl { max-width: 42rem; }
        .max-w-xl { max-width: 36rem; }
        .max-w-lg { max-width: 32rem; }
        .max-w-md { max-width: 28rem; }
        .max-w-sm { max-width: 24rem; }
        .max-w-xs { max-width: 20rem; }
        .h-10 { height: 2.5rem; }
        .h-16 { height: 4rem; }
        .h-20 { height: 5rem; }
        .h-64 { height: 16rem; }
        .h-screen { height: 100vh; }
        .min-h-screen { min-height: 100vh; }
        .transition-colors { transition-property: color, background-color, border-color, text-decoration-color, fill, stroke; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .transition-all { transition-property: all; transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); transition-duration: 150ms; }
        .duration-200 { transition-duration: 200ms; }
        .duration-300 { transition-duration: 300ms; }
        .duration-500 { transition-duration: 500ms; }
        .ease-out { transition-timing-function: cubic-bezier(0, 0, 0.2, 1); }
        .ease-in-out { transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1); }
        .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
        .grid-cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .hover\:bg-gray-100:hover { background-color: #f3f4f6; }
        .hover\:bg-gray-200:hover { background-color: #e5e7eb; }
        .hover\:bg-blue-700:hover { background-color: #1d4ed8; }
        .hover\:bg-blue-200:hover { background-color: #bfdbfe; }
        .hover\:bg-green-200:hover { background-color: #bbf7d0; }
        .hover\:bg-purple-200:hover { background-color: #e9d5ff; }
        .hover\:bg-red-700:hover { background-color: #b91c1c; }
        .hover\:bg-orange-700:hover { background-color: #c2410c; }
        .hover\:text-orange-700:hover { color: #c2410c; }
        .hover\:text-red-700:hover { color: #b91c1c; }
        .hover\:text-gray-700:hover { color: #374151; }
        .focus\:outline-none:focus { outline: 2px solid transparent; outline-offset: 2px; }
        .focus\:ring-2:focus { --tw-ring-offset-shadow: var(--tw-ring-inset) 0 0 0 var(--tw-ring-offset-width) var(--tw-ring-offset-color); --tw-ring-shadow: var(--tw-ring-inset) 0 0 0 calc(2px + var(--tw-ring-offset-width)) var(--tw-ring-color); box-shadow: var(--tw-ring-offset-shadow), var(--tw-ring-shadow), var(--tw-shadow, 0 0 #0000); }
        .focus\:ring-blue-500:focus { --tw-ring-color: #3b82f6; }
        .focus\:ring-transparent:focus { --tw-ring-color: transparent; }
        .focus\:border-transparent:focus { border-color: transparent; }
        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Custom Animations */
        @keyframes slideIn {
            from { transform: translateY(-10px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        @keyframes highlight {
            0% { background-color: #fef3c7; }
            100% { background-color: transparent; }
        }
        @keyframes modalSlideIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }
        .slide-in { animation: slideIn 0.3s ease-out; }
        .highlight { animation: highlight 1s ease-out; }
        .shake { animation: shake 0.5s ease-in-out; }
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            transform: translateX(400px);
            transition: transform 0.3s ease-out;
        }
        .toast.show { transform: translateX(0); }
        .text-item { transition: all 0.2s ease; }
        .text-item:hover { transform: translateX(5px); }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            padding: 2rem;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            animation: modalSlideIn 0.3s ease-out;
            position: relative;
        }
        .auto-save-indicator {
            position: absolute;
            bottom: 1rem;
            left: 50%;
            transform: translateX(-50%);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
            z-index: 10;
        }
        .saving {
            background-color: #fbbf24;
            color: #78350f;
        }
        .saved {
            background-color: #34d399;
            color: #064e3b;
        }
        .time-update {
            transition: color 0.3s ease;
        }
        .time-update.just-updated {
            color: #10b981;
            font-weight: 600;
        }
        
        /* Confirmation Modal Styles */
        .confirm-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }
        .confirm-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .confirm-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease-out;
        }
        .confirm-icon {
            width: 64px;
            height: 64px;
            margin: 0 auto 1.5rem;
            background-color: #fee2e2;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .confirm-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }
        .confirm-yes {
            flex: 1;
            background-color: #ef4444;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
        }
        .confirm-yes:hover {
            background-color: #dc2626;
            transform: translateY(-1px);
        }
        .confirm-no {
            flex: 1;
            background-color: #f3f4f6;
            color: #374151;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
        }
        .confirm-no:hover {
            background-color: #e5e7eb;
            transform: translateY(-1px);
        }
        .draft-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background-color: #ef4444;
            color: white;
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-weight: 600;
            z-index: 5;
        }
        .link-text {
            color: #3b82f6;
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.2s ease;
        }
        .link-text:hover {
            color: #2563eb;
        }
        
        /* View Modal Styles */
        .view-modal {
            display: none;
            position: fixed;
            z-index: 1500;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(5px);
        }
        .view-modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .view-content {
            background: white;
            border-radius: 16px;
            padding: 2rem;
            max-width: 700px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            animation: modalSlideIn 0.3s ease-out;
        }
        .view-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e5e7eb;
        }
        .view-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #1f2937;
            flex: 1;
            margin-right: 1rem;
        }
        .view-close {
            background: #f3f4f6;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: #6b7280;
        }
        .view-close:hover {
            background: #e5e7eb;
            color: #374151;
            transform: rotate(90deg);
        }
        .view-body {
            line-height: 1.6;
            color: #374151;
            white-space: pre-wrap;
            word-wrap: break-word;
        }
        .view-meta {
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
            font-size: 0.875rem;
            color: #6b7280;
        }
        
        /* Install Button Styles */
        .install-button {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 50px;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 100;
        }
        .install-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        .install-button.hidden {
            display: none;
        }
        
        /* Icon styles */
        .icon {
            display: inline-block;
            width: 1em;
            height: 1em;
            stroke-width: 0;
            stroke: currentColor;
            fill: currentColor;
        }
        
        /* PWA Status */
        .pwa-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: #10b981;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
            z-index: 100;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- PWA Status Indicator -->
    <div id="pwaStatus" class="pwa-status">
        <span id="statusText">Online</span>
    </div>

    <!-- Install Button -->
    <button id="installButton" class="install-button hidden">
        <svg class="icon" style="width: 1.25rem; height: 1.25rem;" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
        </svg>
        Install Aplikasi
    </button>

    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <svg class="icon text-blue-600" style="width: 2rem; height: 2rem;" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    <h1 class="text-2xl font-bold text-gray-800">Catatan Saya</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="itemCount" class="text-sm text-gray-600">0 catatan</span>
                    <div class="relative">
                        <button onclick="showClearDraftsConfirm()" class="text-orange-600 hover:text-orange-700 transition-colors flex items-center space-x-2">
                            <svg class="icon" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"/>
                            </svg>
                            <span>Hapus Draft</span>
                        </button>
                        <span id="draftCount" class="draft-badge hidden">0</span>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-6xl mx-auto px-4 py-8">
        <!-- Input Section -->
        <section class="bg-white rounded-lg shadow-md p-6 mb-8">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">Buat Catatan Baru</h2>
            <div class="space-y-4">
                <input 
                    type="text" 
                    id="titleInput" 
                    placeholder="Judul (opsional)"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all"
                >
                <textarea 
                    id="textInput" 
                    placeholder="Tulis catatan Anda di sini..."
                    rows="4"
                    class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all resize-none"
                ></textarea>
                <div class="flex justify-between items-center">
                    <span id="charCount" class="text-sm text-gray-500">0 karakter</span>
                    <button 
                        onclick="addText()" 
                        class="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2"
                    >
                        <svg class="icon" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                        <span>Simpan Catatan</span>
                    </button>
                </div>
            </div>
        </section>

        <!-- Search and Filter -->
        <section class="bg-white rounded-lg shadow-md p-4 mb-6">
            <div class="flex flex-col sm:flex-row gap-4">
                <div class="flex-1 relative">
                    <svg class="icon absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                    <input 
                        type="text" 
                        id="searchInput" 
                        placeholder="Cari catatan..."
                        onkeyup="filterTexts()"
                        class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                    >
                </div>
                <select 
                    id="sortSelect" 
                    onchange="sortTexts()"
                    class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                >
                    <option value="newest">Terbaru</option>
                    <option value="oldest">Terlama</option>
                    <option value="alphabetical">A-Z</option>
                </select>
            </div>
        </section>

        <!-- Text List -->
        <section id="textList" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            <!-- Text items will be dynamically added here -->
        </section>

        <!-- Empty State -->
        <div id="emptyState" class="text-center py-16">
            <svg class="icon text-gray-300 mx-auto mb-4" style="width: 6rem; height: 6rem;" viewBox="0 0 24 24" fill="currentColor">
                <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
            </svg>
            <p class="text-gray-500 text-lg">Belum ada catatan</p>
            <p class="text-gray-400 mt-2">Mulai dengan membuat catatan baru di atas</p>
        </div>
    </main>

    <!-- Edit Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div id="autoSaveIndicator" class="auto-save-indicator saved">
                <svg class="icon inline mr-1" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                </svg>
                Tersimpan
            </div>
            
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold text-white">Edit Catatan</h2>
                <button onclick="closeEditModal()" class="text-white hover:text-gray-200 transition-colors p-2 -mr-2">
                    <svg class="icon" style="width: 2rem; height: 2rem;" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            
            <div class="space-y-4 pb-12">
                <input 
                    type="text" 
                    id="editTitleInput" 
                    placeholder="Judul"
                    class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-transparent outline-none transition-all"
                >
                <textarea 
                    id="editTextInput" 
                    placeholder="Konten catatan..."
                    rows="8"
                    class="w-full px-4 py-3 bg-white/20 backdrop-blur-sm border border-white/30 rounded-lg text-white placeholder-white/70 focus:ring-2 focus:ring-white/50 focus:border-transparent outline-none transition-all resize-none"
                ></textarea>
                <div class="flex justify-between items-center">
                    <span id="editCharCount" class="text-white/80 text-sm">0 karakter</span>
                    <div class="space-x-2">
                        <button 
                            onclick="saveEditedText()" 
                            class="bg-white text-purple-600 px-6 py-2 rounded-lg hover:bg-gray-100 transition-colors font-medium"
                        >
                            <svg class="icon inline mr-2" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/>
                            </svg>
                            Simpan Perubahan
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- View Modal -->
    <div id="viewModal" class="view-modal">
        <div class="view-content">
            <div class="view-header">
                <h3 class="view-title" id="viewTitle">Judul Catatan</h3>
                <button onclick="closeViewModal()" class="view-close">
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="view-body" id="viewContent">
                Konten catatan akan ditampilkan di sini...
            </div>
            <div class="view-meta">
                <div class="flex justify-between items-center">
                    <span id="viewCreated">Dibuat: -</span>
                    <span id="viewUpdated">Diperbarui: -</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteConfirmModal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-icon">
                <svg class="icon text-red-600" style="width: 3rem; height: 3rem;" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-900 text-center mb-2">Konfirmasi Hapus</h3>
            <p class="text-gray-600 text-center mb-6" id="deleteConfirmMessage">
                Apakah Anda yakin ingin menghapus catatan ini?
            </p>
            <div class="confirm-buttons">
                <button onclick="confirmDelete()" class="confirm-yes">
                    <svg class="icon inline mr-2" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Ya
                </button>
                <button onclick="closeDeleteConfirm()" class="confirm-no">
                    <svg class="icon inline mr-2" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                    Tidak
                </button>
            </div>
        </div>
    </div>

    <!-- Clear Drafts Confirmation Modal -->
    <div id="clearDraftsConfirmModal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-icon">
                <svg class="icon text-orange-600" style="width: 3rem; height: 3rem;" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
            </div>
            <h3 class="text-xl font-bold text-gray-900 text-center mb-2">Hapus Semua Draft</h3>
            <p class="text-gray-600 text-center mb-6" id="clearDraftsMessage">
                Apakah Anda yakin ingin menghapus <span id="draftsToDelete">0</span> draft? Tindakan ini tidak dapat dibatalkan.
            </p>
            <div class="confirm-buttons">
                <button onclick="confirmClearDrafts()" class="confirm-yes">
                    <svg class="icon inline mr-2" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
                    </svg>
                    Ya, Hapus Draft
                </button>
                <button onclick="closeClearDraftsConfirm()" class="confirm-no">
                    <svg class="icon inline mr-2" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                    Batal
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast bg-green-600 text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2">
        <svg class="icon" style="width: 1.25rem; height: 1.25rem;" viewBox="0 0 24 24" fill="currentColor">
            <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </svg>
        <span id="toastMessage">Catatan berhasil disimpan!</span>
    </div>

    <script>
        // PWA Installation
        let deferredPrompt;
        const installButton = document.getElementById('installButton');
        
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            installButton.classList.remove('hidden');
        });
        
        installButton.addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                if (outcome === 'accepted') {
                    installButton.classList.add('hidden');
                }
                deferredPrompt = null;
            }
        });
        
        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            const swCode = `
                self.addEventListener('install', (event) => {
                    self.skipWaiting();
                });
                
                self.addEventListener('activate', (event) => {
                    event.waitUntil(clients.claim());
                });
                
                self.addEventListener('fetch', (event) => {
                    event.respondWith(fetch(event.request));
                });
            `;
            
            const blob = new Blob([swCode], { type: 'application/javascript' });
            const swUrl = URL.createObjectURL(blob);
            
            navigator.serviceWorker.register(swUrl).then(() => {
                console.log('Service Worker registered');
            });
        }
        
        // Online/Offline Status
        function updateOnlineStatus() {
            const statusText = document.getElementById('statusText');
            const pwaStatus = document.getElementById('pwaStatus');
            
            if (navigator.onLine) {
                statusText.textContent = 'Online';
                pwaStatus.style.background = '#10b981';
            } else {
                statusText.textContent = 'Offline';
                pwaStatus.style.background = '#ef4444';
            }
        }
        
        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();
        
        // Initialize
        let texts = JSON.parse(localStorage.getItem('savedTexts')) || [];
        let filteredTexts = [...texts];
        let currentEditingId = null;
        let currentViewingId = null;
        let autoSaveTimeout = null;
        let lastEditedId = null;
        let timeUpdateInterval = null;
        let recentlyUpdatedIds = new Set();
        let deleteTargetId = null;

        // Load texts on page load
        document.addEventListener('DOMContentLoaded', () => {
            renderTexts();
            updateCharCount();
            startTimeUpdate();
            updateDraftCount();
        });

        // Start time update interval
        function startTimeUpdate() {
            // Update every second for smooth time changes
            timeUpdateInterval = setInterval(() => {
                updateTimeStamps();
            }, 1000);
        }

        // Update all time stamps
        function updateTimeStamps() {
            const timeElements = document.querySelectorAll('.time-stamp');
            timeElements.forEach(element => {
                const timestamp = element.getAttribute('data-timestamp');
                const textId = parseInt(element.getAttribute('data-text-id'));
                if (timestamp) {
                    element.textContent = formatDate(timestamp);
                    
                    // Remove just-updated class after 3 seconds
                    if (recentlyUpdatedIds.has(textId)) {
                        element.classList.add('just-updated');
                        setTimeout(() => {
                            element.classList.remove('just-updated');
                            recentlyUpdatedIds.delete(textId);
                        }, 3000);
                    }
                }
            });
        }

        // Stop time update when page is not visible
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                clearInterval(timeUpdateInterval);
            } else {
                startTimeUpdate();
            }
        });

        // Character counter for main input
        document.getElementById('textInput').addEventListener('input', updateCharCount);
        
        // Character counter for edit input
        document.getElementById('editTextInput').addEventListener('input', updateEditCharCount);

        function updateCharCount() {
            const text = document.getElementById('textInput').value;
            document.getElementById('charCount').textContent = `${text.length} karakter`;
        }

        function updateEditCharCount() {
            const text = document.getElementById('editTextInput').value;
            document.getElementById('editCharCount').textContent = `${text.length} karakter`;
        }

        // Update draft count
        function updateDraftCount() {
            const draftCount = texts.filter(text => text.deleted).length;
            const draftBadge = document.getElementById('draftCount');
            const draftsToDelete = document.getElementById('draftsToDelete');
            
            if (draftCount > 0) {
                draftBadge.textContent = draftCount;
                draftBadge.classList.remove('hidden');
                draftsToDelete.textContent = draftCount;
            } else {
                draftBadge.classList.add('hidden');
            }
        }

        // Detect and convert URLs to clickable links
        function linkifyText(text) {
            const urlRegex = /(https?:\/\/[^\s]+)/g;
            return text.replace(urlRegex, '<a href="$1" class="link-text" target="_blank" rel="noopener noreferrer">$1</a>');
        }

        // Check if text is a URL
        function isUrl(text) {
            const urlRegex = /^https?:\/\/[^\s]+$/;
            return urlRegex.test(text.trim());
        }

        // Open URL in browser
        function openUrl(url) {
            window.open(url, '_blank', 'noopener,noreferrer');
        }

        // Add new text
        function addText() {
            const title = document.getElementById('titleInput').value.trim();
            const content = document.getElementById('textInput').value.trim();
            
            if (!content) {
                showToast('Masukkan catatan terlebih dahulu!', 'error');
                return;
            }

            const now = new Date().toISOString();
            const newText = {
                id: Date.now(),
                title: title || 'Tanpa Judul',
                content: content,
                createdAt: now,
                lastUsed: now,
                updatedAt: now,
                deleted: false
            };

            texts.unshift(newText);
            saveToLocalStorage();
            
            // Update filtered texts and render
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            if (!searchTerm || newText.title.toLowerCase().includes(searchTerm) || newText.content.toLowerCase().includes(searchTerm)) {
                filteredTexts = [...texts];
                sortTexts();
            } else {
                renderTexts();
            }
            
            // Clear inputs
            document.getElementById('titleInput').value = '';
            document.getElementById('textInput').value = '';
            updateCharCount();
            
            showToast('Catatan berhasil disimpan!');
        }

        // Render texts
        function renderTexts() {
            const textList = document.getElementById('textList');
            const emptyState = document.getElementById('emptyState');
            const itemCount = document.getElementById('itemCount');
            
            // Only show non-deleted texts
            const activeTexts = filteredTexts.filter(text => !text.deleted);
            
            if (activeTexts.length === 0) {
                textList.innerHTML = '';
                emptyState.style.display = 'block';
                itemCount.textContent = '0 catatan';
                return;
            }
            
            emptyState.style.display = 'none';
            itemCount.textContent = `${activeTexts.length} catatan`;
            
            textList.innerHTML = activeTexts.map(text => `
                <div class="text-item bg-white rounded-lg shadow-md p-4 hover:shadow-lg slide-in ${text.id === lastEditedId ? 'highlight' : ''}" id="text-${text.id}">
                    <div class="flex justify-between items-start mb-2">
                        <h3 class="font-semibold text-gray-800 truncate flex-1">${escapeHtml(text.title)}</h3>
                        <button onclick="showDeleteConfirm(${text.id})" class="text-red-500 hover:text-red-700 ml-2 transition-colors">
                            <svg class="icon" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                            </svg>
                        </button>
                    </div>
                    <p class="text-gray-600 text-sm mb-3 line-clamp-3">${linkifyText(escapeHtml(text.content))}</p>
                    <div class="flex justify-between items-center">
                        <span class="time-stamp time-update text-xs text-gray-400" 
                              data-timestamp="${text.updatedAt || text.createdAt}" 
                              data-text-id="${text.id}">
                            ${formatDate(text.updatedAt || text.createdAt)}
                        </span>
                        <div class="flex space-x-2">
                            <button onclick="copyText('${escapeHtml(text.content)}', ${text.id})" class="bg-blue-100 text-blue-600 px-3 py-1 rounded text-sm hover:bg-blue-200 transition-colors">
                                <svg class="icon inline mr-1" style="width: 0.875rem; height: 0.875rem;" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/>
                                </svg>
                                Salin
                            </button>
                            <button onclick="viewOrOpenLink(${text.id})" class="bg-green-100 text-green-600 px-3 py-1 rounded text-sm hover:bg-green-200 transition-colors">
                                <svg class="icon inline mr-1" style="width: 0.875rem; height: 0.875rem;" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
                                </svg>
                                Lihat
                            </button>
                            <button onclick="openEditModal(${text.id})" class="bg-purple-100 text-purple-600 px-3 py-1 rounded text-sm hover:bg-purple-200 transition-colors">
                                <svg class="icon inline mr-1" style="width: 0.875rem; height: 0.875rem;" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
                                </svg>
                                Edit
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            // Add click event listeners to links
            setTimeout(() => {
                document.querySelectorAll('.link-text').forEach(link => {
                    link.addEventListener('click', (e) => {
                        e.preventDefault();
                        openUrl(link.href);
                    });
                });
            }, 100);
            
            // Remove highlight after animation
            if (lastEditedId) {
                setTimeout(() => {
                    const element = document.getElementById(`text-${lastEditedId}`);
                    if (element) {
                        element.classList.remove('highlight');
                    }
                    lastEditedId = null;
                }, 1000);
            }
        }

        // Copy text to clipboard
        async function copyText(text, id) {
            try {
                await navigator.clipboard.writeText(text);
                showToast('Catatan berhasil disalin!');
                
                // Update last used time
                const textObj = texts.find(t => t.id === id);
                if (textObj) {
                    textObj.lastUsed = new Date().toISOString();
                    saveToLocalStorage();
                }
            } catch (err) {
                showToast('Gagal menyalin catatan', 'error');
            }
        }

        // View text or open link if it's a URL
        function viewOrOpenLink(id) {
            const text = texts.find(t => t.id === id);
            if (text) {
                // Check if content is a URL
                if (isUrl(text.content)) {
                    // Open URL directly
                    openUrl(text.content.trim());
                    showToast('Membuka link di browser...');
                    
                    // Update last used time
                    text.lastUsed = new Date().toISOString();
                    saveToLocalStorage();
                } else {
                    // Show view modal for regular text
                    showViewModal(id);
                }
            }
        }

        // Show view modal
        function showViewModal(id) {
            const text = texts.find(t => t.id === id);
            if (text) {
                currentViewingId = id;
                document.getElementById('viewTitle').textContent = text.title;
                document.getElementById('viewContent').innerHTML = linkifyText(escapeHtml(text.content));
                document.getElementById('viewCreated').textContent = `Dibuat: ${formatDate(text.createdAt)}`;
                document.getElementById('viewUpdated').textContent = `Diperbarui: ${formatDate(text.updatedAt || text.createdAt)}`;
                document.getElementById('viewModal').classList.add('show');
                
                // Add click event listeners to links in view modal
                setTimeout(() => {
                    document.querySelectorAll('#viewContent .link-text').forEach(link => {
                        link.addEventListener('click', (e) => {
                            e.preventDefault();
                            openUrl(link.href);
                        });
                    });
                }, 100);
                
                // Update last used time
                text.lastUsed = new Date().toISOString();
                saveToLocalStorage();
            }
        }

        // Close view modal
        function closeViewModal() {
            document.getElementById('viewModal').classList.remove('show');
            currentViewingId = null;
        }

        // Show delete confirmation
        function showDeleteConfirm(id) {
            deleteTargetId = id;
            const text = texts.find(t => t.id === id);
            if (text) {
                document.getElementById('deleteConfirmMessage').textContent = 
                    `Apakah Anda yakin ingin menghapus catatan "${text.title}"?`;
            }
            document.getElementById('deleteConfirmModal').classList.add('show');
        }

        // Close delete confirmation
        function closeDeleteConfirm() {
            document.getElementById('deleteConfirmModal').classList.remove('show');
            deleteTargetId = null;
        }

        // Confirm delete
        function confirmDelete() {
            if (deleteTargetId) {
                // Mark as deleted instead of removing
                const textIndex = texts.findIndex(t => t.id === deleteTargetId);
                if (textIndex !== -1) {
                    texts[textIndex].deleted = true;
                    texts[textIndex].deletedAt = new Date().toISOString();
                    saveToLocalStorage();
                    filterTexts();
                    updateDraftCount();
                    showToast('Catatan dipindahkan ke draft!');
                    closeDeleteConfirm();
                }
            }
        }

        // Show clear drafts confirmation
        function showClearDraftsConfirm() {
            const draftCount = texts.filter(text => text.deleted).length;
            if (draftCount === 0) {
                showToast('Tidak ada draft untuk dihapus!', 'error');
                return;
            }
            document.getElementById('clearDraftsConfirmModal').classList.add('show');
        }

        // Close clear drafts confirmation
        function closeClearDraftsConfirm() {
            document.getElementById('clearDraftsConfirmModal').classList.remove('show');
        }

        // Confirm clear drafts
        function confirmClearDrafts() {
            // Remove all deleted texts permanently
            texts = texts.filter(text => !text.deleted);
            saveToLocalStorage();
            filterTexts();
            updateDraftCount();
            showToast('Semua draft berhasil dihapus!');
            closeClearDraftsConfirm();
        }

        // Open edit modal
        function openEditModal(id) {
            const text = texts.find(t => t.id === id);
            if (text) {
                currentEditingId = id;
                document.getElementById('editTitleInput').value = text.title;
                document.getElementById('editTextInput').value = text.content;
                updateEditCharCount();
                document.getElementById('editModal').classList.add('show');
                
                // Add event listeners for auto-save
                document.getElementById('editTitleInput').addEventListener('input', triggerAutoSave);
                document.getElementById('editTextInput').addEventListener('input', triggerAutoSave);
            }
        }

        // Close edit modal
        function closeEditModal() {
            document.getElementById('editModal').classList.remove('show');
            currentEditingId = null;
            
            // Remove event listeners
            document.getElementById('editTitleInput').removeEventListener('input', triggerAutoSave);
            document.getElementById('editTextInput').removeEventListener('input', triggerAutoSave);
            
            // Clear timeout if exists
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
                autoSaveTimeout = null;
            }
        }

        // Trigger auto-save with debounce
        function triggerAutoSave() {
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.className = 'auto-save-indicator saving';
            indicator.innerHTML = '<svg class="icon inline mr-1 animate-spin" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor"><path d="M12,4V2A10,10 0 0,0 2,12H4A8,8 0 0,1 12,4Z"><animateTransform attributeName="transform" attributeType="XML" type="rotate" from="0 12 12" to="360 12 12" dur="1s" repeatCount="indefinite"/></path></svg> Menyimpan...';
            
            // Clear previous timeout
            if (autoSaveTimeout) {
                clearTimeout(autoSaveTimeout);
            }
            
            // Set new timeout
            autoSaveTimeout = setTimeout(() => {
                saveEditedText(true);
            }, 1000); // Auto-save after 1 second of inactivity
        }

        // Save edited text
        function saveEditedText(isAutoSave = false) {
            if (!currentEditingId) return;
            
            const title = document.getElementById('editTitleInput').value.trim();
            const content = document.getElementById('editTextInput').value.trim();
            
            if (!content) {
                showToast('Konten tidak boleh kosong!', 'error');
                return;
            }
            
            const textIndex = texts.findIndex(t => t.id === currentEditingId);
            if (textIndex !== -1) {
                const now = new Date().toISOString();
                texts[textIndex].title = title || 'Tanpa Judul';
                texts[textIndex].content = content;
                texts[textIndex].lastUsed = now;
                texts[textIndex].updatedAt = now; // Update the timestamp
                
                saveToLocalStorage();
                
                // Update filtered texts
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                if (!searchTerm || title.toLowerCase().includes(searchTerm) || content.toLowerCase().includes(searchTerm)) {
                    // Item should be visible, update it in filteredTexts
                    const filteredIndex = filteredTexts.findIndex(t => t.id === currentEditingId);
                    if (filteredIndex !== -1) {
                        filteredTexts[filteredIndex] = {...texts[textIndex]};
                    } else {
                        // Item was filtered out but now matches search, add it back
                        filteredTexts = [...texts];
                    }
                } else {
                    // Item no longer matches search, remove it from filteredTexts
                    filteredTexts = filteredTexts.filter(t => t.id !== currentEditingId);
                }
                
                // Set last edited ID for highlighting
                lastEditedId = currentEditingId;
                
                // Add to recently updated for visual feedback
                recentlyUpdatedIds.add(currentEditingId);
                
                // Re-sort and render
                sortTexts();
                
                // Update indicator
                const indicator = document.getElementById('autoSaveIndicator');
                indicator.className = 'auto-save-indicator saved';
                indicator.innerHTML = '<svg class="icon inline mr-1" style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg> Tersimpan';
                
                if (!isAutoSave) {
                    showToast('Perubahan berhasil disimpan!');
                    closeEditModal();
                }
            }
        }

        // Filter texts
        function filterTexts() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            filteredTexts = texts.filter(text => 
                !text.deleted && (
                    text.title.toLowerCase().includes(searchTerm) || 
                    text.content.toLowerCase().includes(searchTerm)
                )
            );
            sortTexts();
        }

        // Sort texts
        function sortTexts() {
            const sortBy = document.getElementById('sortSelect').value;
            
            switch(sortBy) {
                case 'newest':
                    filteredTexts.sort((a, b) => new Date(b.updatedAt || b.createdAt) - new Date(a.updatedAt || a.createdAt));
                    break;
                case 'oldest':
                    filteredTexts.sort((a, b) => new Date(a.updatedAt || a.createdAt) - new Date(a.updatedAt || a.createdAt));
                    break;
                case 'alphabetical':
                    filteredTexts.sort((a, b) => a.title.localeCompare(b.title));
                    break;
            }
            
            renderTexts();
        }

        // Save to localStorage
        function saveToLocalStorage() {
            localStorage.setItem('savedTexts', JSON.stringify(texts));
        }

        // Show toast notification
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            const toastMessage = document.getElementById('toastMessage');
            
            toastMessage.textContent = message;
            toast.className = `toast ${type === 'error' ? 'bg-red-600' : 'bg-green-600'} text-white px-6 py-3 rounded-lg shadow-lg flex items-center space-x-2 show`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // Format date with detailed time for older items
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            // Less than a minute
            if (diff < 60000) return 'Baru saja';
            
            // Less than an hour
            if (diff < 3600000) return `${Math.floor(diff / 60000)} menit lalu`;
            
            // Less than a day
            if (diff < 86400000) return `${Math.floor(diff / 3600000)} jam lalu`;
            
            // Less than a week
            if (diff < 604800000) return `${Math.floor(diff / 86400000)} hari lalu`;
            
            // More than a week - show detailed format
            const days = ['Minggu', 'Senin', 'Selasa', 'Rabu', 'Kamis', 'Jumat', 'Sabtu'];
            const months = ['Januari', 'Februari', 'Maret', 'April', 'Mei', 'Juni', 
                          'Juli', 'Agustus', 'September', 'Oktober', 'November', 'Desember'];
            
            const dayName = days[date.getDay()];
            const day = date.getDate();
            const month = months[date.getMonth()];
            const year = date.getFullYear();
            const hours = date.getHours().toString().padStart(2, '0');
            const minutes = date.getMinutes().toString().padStart(2, '0');
            
            return `${dayName}, ${day} ${month} ${year}  ${hours}:${minutes}`;
        }

        // Escape HTML
        function escapeHtml(text) {
            const map = {
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#039;'
            };
            return text.replace(/[&<>"']/g, m => map[m]);
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Enter to save
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                if (document.getElementById('editModal').classList.contains('show')) {
                    saveEditedText();
                } else {
                    addText();
                }
            }
            
            // Escape to close modals
            if (e.key === 'Escape') {
                if (document.getElementById('editModal').classList.contains('show')) {
                    closeEditModal();
                } else if (document.getElementById('viewModal').classList.contains('show')) {
                    closeViewModal();
                } else if (document.getElementById('deleteConfirmModal').classList.contains('show')) {
                    closeDeleteConfirm();
                } else if (document.getElementById('clearDraftsConfirmModal').classList.contains('show')) {
                    closeClearDraftsConfirm();
                }
            }
        });

        // Close modals when clicking outside
        document.getElementById('editModal').addEventListener('click', (e) => {
            if (e.target.id === 'editModal') {
                closeEditModal();
            }
        });

        document.getElementById('viewModal').addEventListener('click', (e) => {
            if (e.target.id === 'viewModal') {
                closeViewModal();
            }
        });

        document.getElementById('deleteConfirmModal').addEventListener('click', (e) => {
            if (e.target.id === 'deleteConfirmModal') {
                closeDeleteConfirm();
            }
        });

        document.getElementById('clearDraftsConfirmModal').addEventListener('click', (e) => {
            if (e.target.id === 'clearDraftsConfirmModal') {
                closeClearDraftsConfirm();
            }
        });

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (timeUpdateInterval) {
                clearInterval(timeUpdateInterval);
            }
        });
    </script>
</body>
</html>